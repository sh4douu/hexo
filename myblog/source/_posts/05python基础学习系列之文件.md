---
title: Python基础学习系列Chapter 6：文件
date: 2019-03-19 16:27:20
tags:
	- Python基础
	- Language
categories: 语言
---

### 0x00 文件概述

- 文件读写的内容都是字符串，而不是对象。

### 0x01 文件操作

#### 打开文件

- open函数会创建并返回一个文件对象，作为到计算机一个文件的连接。
- 调用返回的文件对象的方法，可以操作外部文件。

```python
f=open('test.txt','w',0,encoding='utf-8')
```

<!-- more -->

> - 第一个参数：文件名。不用绝对路径默认为当前运行脚本所在的目录。
> - 第二个参数：处理模式。默认是'r'
>   - `r` ----> 只读
>   - `w` ----> 只写。会先创建一个文件，如果已经存在则覆盖，因此原来的文件的内容会被清空。
>   - `a` ----> 追加。已经存在文件则在之后追加内容。
>   - `x` ----> 新建文件（写模式），若文件已存在，会报错，文件不存在才能新建成功。
>   - `r+` ---> 读写。写是清空写，而不是追加。
>   - `w+` ---> 写读。会先新建/清空文件，因此并不能读到之前文件的内容，只能读到后面写入的。
>   - `a+` ---> 追加读。所有写的内容只能追加在文件最后。
>   - 文件操作模式后可以加`b`，表示以二进制方式操作文件。
> - 前面两个参数必须是字符串类型。
> - 第三个参数：控制输出缓存。0表示无缓存，即写入的内容直接输出给硬盘等外部；其他数字表示缓存区满后再输出到外部文件。
> - 第四个参数：可以设置文件的编码。

#### 文件位置

- 文件对象会有一个文件位置，可以想象为指针/光标，指示着文件当前所处的状态，刚创建的文件对象，偏移量默认为0。
- 偏移量的单位为字节，一个汉字两个字节。
- tell()：查看文件当前位置（偏移量）。
- seek()：改变文件位置到指定偏移量并返回偏移量。

```python
f.seek(2)   #改变文件的光标到第二个字节处
```

#### 读文件

- 读操作永远从文件位置开始。
- read()、readline、readlines()都是先将整个文件读到内存当中，若文件很大时，占用大量内存且速度慢。
- 而从文件当中获取内容的最好方法是根本不读取，使用for循坏文件对象。for循环会每次只读取一行到内存，且内存每次只存在一行。

```python
for line in f:
    print(line)
```

##### read() #将文件内容读为一个字符串

```python
f.read()    #读取文件光标后的所有内容
f.read(2)   #读取文件位置后的2个字符
```

- 读取的开始位置是当前文件的位置。
- 读取的内容会作为单一字符串。
- 读取后，文件的位置（光标）也会相应移动。
- 单位是字符个数，而不是字节。

##### readline() #读取一行为一个字符串

```python
f.readline()    #读取光标位置到行末
f.readline(3)   #等同于f.read(3)
```

- 读取的开始位置是当前文件的位置。
- 读取的结束是该行的结束，即出现换行符
- 读取后，文件的位置（光标）也会相应移动

##### readlines() #读取文件的每一行到一个字符串列表

```python
f.readlines()    #读取光标位置到行末为一个字符串并作为列表的一个元素
f.readlines(3)   #读取一行到列表中
```

#### 写文件

- w操作使用seek()到指定位置插入时会将原位置的内容覆盖。
- a操作使用seek()没有用，都只会追加在最后。
- 特别注意：写入时，光标也在不断后移。

##### write() #写入字符串

```python
f.write('abc')                             #写入字节字符串并返回写入的字符数
f.write(bytes('abc',encoding='utf-8'))     #写入二进制字符串
```

- 当操作模式加了b时，写入只能写入二进制内容。

##### writelines() #将字符串列表内容写入文件

```python
list=['this','is','aString']

f.writelines(list)
```

- 列表储存的只能是字符串对象

#### 修改文件

- 所有写操作都不能做到，在文件的内容之间插入内容。修改文件的两个方法：一是全部读到内存修改；二是新建一个文件。
- 读到内存修改：如VIM等编辑器就是这种方式，整个文件读到内存，在内存修改后再写回文件中。文件大时肯定效率低。
- 新建文件方式修改文件：

```python
#将文件中存在'b'的这行改为'B'
with open('old.txt') as old,/
    open('new.txt','w') as new:
    for line in old:
        if line=='b\n':
            line='B\n'
        new.write(line)
        
```

#### 关闭文件

- 当文件对象不再被引用时也会自动关闭，即f引用其他对象。

##### f.close()

##### f.flush() #将内存输出缓冲区内容刷入硬盘，但不关闭文件

- 写入文件的内容可能不会立即写入硬盘当中，而是存在内存的输出缓存区中。
- flush()和close()都能刷新缓冲区